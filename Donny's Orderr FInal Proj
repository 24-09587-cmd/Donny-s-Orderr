import java.util.*;

// Base class
abstract class MenuItem {
    private String name;
    private double price;
    private int calories;
    private String category;
    private List<String> allergens;

    public MenuItem(String name, double price, int calories, String category, List<String> allergens) {
        this.name = name;
        this.price = price;
        this.calories = calories;
        this.category = category;
        this.allergens = allergens;
    }

    public String getName() { return name; }
    public double getPrice() { return price; }
    public int getCalories() { return calories; }
    public String getCategory() { return category; }
    public List<String> getAllergens() { return allergens; }

    public void setName(String name) { this.name = name; }
    public void setPrice(double price) { this.price = price; }
    public void setCalories(int calories) { this.calories = calories; }
    public void setCategory(String category) { this.category = category; }

    public abstract void display();
}

// Single meal
class SingleMeal extends MenuItem {
    public SingleMeal(String name, double price, int calories, String category, List<String> allergens) {
        super(name, price, calories, category, allergens);
    }

    @Override
    public void display() {
        System.out.printf("%s | %.2f | %d cal | %s%n",
                getName(), getPrice(), getCalories(), getCategory());
    }
}

// Combo meal
class ComboMeal extends MenuItem {
    private List<MenuItem> items;

    public ComboMeal(String name, double price, List<MenuItem> items) {
        super(name, price, 0, "Combo", new ArrayList<>());
        this.items = items;
    }

    @Override
    public void display() {
        System.out.printf("%s (Combo) | %.2f | Items: ", getName(), getPrice());
        for (MenuItem item : items) {
            System.out.print(item.getName() + " ");
        }
        System.out.println();
    }
}

// Order system
class OrderSystem {
    private List<MenuItem> menu = new ArrayList<>();
    private List<MenuItem> cart = new ArrayList<>();
    private Scanner sc = new Scanner(System.in);

    public OrderSystem() {
        seedMenu();
    }

    private void seedMenu() {
        MenuItem burger = new SingleMeal("Classic Burger", 120, 550, "Regular", Arrays.asList("gluten"));
        MenuItem fries = new SingleMeal("French Fries", 60, 300, "Regular", new ArrayList<>());
        MenuItem chicken = new SingleMeal("Fried Chicken", 150, 700, "Spicy", Arrays.asList("soy"));
        MenuItem salad = new SingleMeal("Veggie Salad", 90, 180, "Vegan", new ArrayList<>());

        menu.add(burger);
        menu.add(fries);
        menu.add(chicken);
        menu.add(salad);

        menu.add(new ComboMeal("Burger Combo", 199, Arrays.asList(burger, fries)));
        menu.add(new ComboMeal("Chicken Combo", 249, Arrays.asList(chicken, fries)));
    }

    public void start() {
        while (true) {
            System.out.println("\n==============================");
            System.out.println("       DONNY'S ORDER SYSTEM");
            System.out.println("==============================");
            System.out.println("1. View Menu");
            System.out.println("2. Add to Cart");
            System.out.println("3. View Cart + Receipt");
            System.out.println("4. Sort Menu by Price");
            System.out.println("5. Allergy-Smart Filter");
            System.out.println("6. Mood-Based Recommendation");
            System.out.println("7. Auto-Budget Ordering");
            System.out.println("8. Admin Mode");
            System.out.println("9. Exit");
            System.out.print("Choose: ");

            int choice = sc.nextInt();
            sc.nextLine();

            switch (choice) {
                case 1: showMenu(); break;
                case 2: addToCart(); break;
                case 3: showCart(); break;
                case 4: sortMenu(); break;
                case 5: allergyFilter(); break;
                case 6: moodRecommend(); break;
                case 7: budgetOrder(); break;
                case 8: adminMode(); break;
                case 9: System.out.println("Goodbye!"); return;
                default: System.out.println("Invalid option!");
            }
        }
    }

    private void showMenu() {
        System.out.println("\nMenu:");
        for (int i = 0; i < menu.size(); i++) {
            System.out.print((i + 1) + ". ");
            menu.get(i).display();
        }
        System.out.println("==============================");
    }

    private void addToCart() {
        showMenu();
        System.out.print("Enter item number to add to cart: ");
        int choice = sc.nextInt();
        sc.nextLine();
        if (choice < 1 || choice > menu.size()) {
            System.out.println("Invalid item.");
            return;
        }
        cart.add(menu.get(choice - 1));
        System.out.println("Added to cart!");
    }

    private void showCart() {
        if (cart.isEmpty()) {
            System.out.println("Cart is empty.");
            return;
        }
        double total = 0;
        System.out.println("\nYour Receipt:");
        for (MenuItem i : cart) {
            System.out.printf("â€¢ %-20s %.2f%n", i.getName(), i.getPrice());
            total += i.getPrice();
        }
        System.out.printf("Subtotal: %.2f%n", total);

        System.out.print("Are you a student? (yes/no): ");
        String ans = sc.nextLine().toLowerCase();
        if (ans.equals("yes")) {
            double discount = total * 0.10;
            total -= discount;
            System.out.printf("Student Discount (10%%): -%.2f%n", discount);
        }

        System.out.printf("TOTAL: %.2f%n", total);
    }

    private void sortMenu() {
        menu.sort(Comparator.comparingDouble(MenuItem::getPrice));
        System.out.println("Menu sorted by price.");
        showMenu();
    }

    private void allergyFilter() {
        System.out.print("Enter item to avoid (e.g., burger, fries): ");
        String avoidItem = sc.nextLine().toLowerCase();

        System.out.println("Menu excluding " + avoidItem + ":");
        boolean found = false;

        for (MenuItem m : menu) {
            if (!m.getName().toLowerCase().contains(avoidItem)) {
                m.display();
                found = true;
            }
        }
        if (!found) System.out.println("No items available after filter.");
    }

    private void moodRecommend() {
        System.out.print("Your mood (hungry/sad/healthy/happy): ");
        String mood = sc.nextLine().toLowerCase();

        if (mood.equals("hungry"))
            menu.stream().max(Comparator.comparingInt(MenuItem::getCalories)).ifPresent(MenuItem::display);
        else if (mood.equals("sad"))
            menu.stream().filter(m -> m.getCategory().equals("Spicy")).findFirst().ifPresent(MenuItem::display);
        else if (mood.equals("healthy"))
            menu.stream().filter(m -> m.getCategory().equals("Vegan")).findFirst().ifPresent(MenuItem::display);
        else if (mood.equals("happy"))
            menu.stream().filter(m -> m instanceof ComboMeal).findFirst().ifPresent(MenuItem::display);
        else
            System.out.println("No matching mood.");
    }

    private void budgetOrder() {
        System.out.print("Enter your budget: ");
        double budget = sc.nextDouble();
        sc.nextLine();

        System.out.println("Items within your budget:");
        for (MenuItem m : menu)
            if (m.getPrice() <= budget)
                m.display();
    }

    private void adminMode() {
        System.out.println("1. Add Item\n2. Edit Item\n3. Delete Item\nChoose: ");
        int c = sc.nextInt();
        sc.nextLine();

        if (c == 1) addItem();
        else if (c == 2) editItem();
        else if (c == 3) deleteItem();
        else System.out.println("Invalid option!");
    }

    private void addItem() {
        System.out.print("Name: ");
        String name = sc.nextLine();
        System.out.print("Price: ");
        double price = sc.nextDouble();
        sc.nextLine();
        System.out.print("Calories: ");
        int cal = sc.nextInt();
        sc.nextLine();
        System.out.print("Category: ");
        String cat = sc.nextLine();

        menu.add(new SingleMeal(name, price, cal, cat, new ArrayList<>()));
        System.out.println("Item added!");
    }

    private void editItem() {
        showMenu();
        System.out.print("Select item to edit: ");
        int i = sc.nextInt();
        sc.nextLine();

        if (i < 1 || i > menu.size()) return;

        MenuItem m = menu.get(i - 1);

        System.out.print("New Name: ");
        m.setName(sc.nextLine());
        System.out.print("New Price: ");
        m.setPrice(sc.nextDouble());
        sc.nextLine();
        System.out.print("New Calories: ");
        m.setCalories(sc.nextInt());
        sc.nextLine();
        System.out.print("New Category: ");
        m.setCategory(sc.nextLine());

        System.out.println("Item updated!");
    }

    private void deleteItem() {
        showMenu();
        System.out.print("Delete item #: ");
        int i = sc.nextInt();
        sc.nextLine();

        if (i < 1 || i > menu.size()) return;

        menu.remove(i - 1);
        System.out.println("Item deleted!");
    }
}

// Main class
public class Main {
    public static void main(String[] args) {
        OrderSystem system = new OrderSystem();
        system.start();
    }
}